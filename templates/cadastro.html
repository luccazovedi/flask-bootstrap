{% extends "base.html" %}

{% block page_content %}
<div class="container py-4">
    <!-- H1 dinâmico -->
    <h1>Olá, <span id="nomeTitulo">{{ nome_envio or 'Stranger' }}</span>!</h1>

    <!-- Mensagem fixa após envio -->
    {% if mensagem_extra %}
    <p id="mensagemExtra">{{ mensagem_extra|replace('\n','<br>')|safe }}</p>
    {% else %}
    <p id="mensagemExtra" style="display:none;"></p>
    {% endif %}

    <!-- Formulário -->
    <form id="formCadastro" method="POST" class="mb-2">
        {{ form.hidden_tag() }}
        <div class="mb-2">
            {{ form.nome.label(class="form-label") }}
            {{ form.nome(class="form-control", placeholder="Digite o nome do usuário") }}
        </div>
        <div class="form-check mb-2">
            {{ form.enviar_email(class="form-check-input") }}
            {{ form.enviar_email.label(class="form-check-label") }}
        </div>
        {{ form.submit(class="btn btn-primary") }}
    </form>

    <!-- Flash temporário -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mt-2">
          {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible" role="alert">
              {{ message|replace('\n','<br>')|safe }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Lista de usuários -->
    {% if usuarios %}
      <h3 class="mt-3 mb-2">Relação de usuários cadastrados</h3>
      <table class="table table-striped table-bordered align-middle">
        <thead class="table-dark">
          <tr>
            <th>Nome do usuário</th>
            <th>Função</th>
          </tr>
        </thead>
        <tbody>
          {% for usuario in usuarios %}
          <tr>
            <td>{{ usuario.nome }}</td>
            <td>{{ usuario.funcao }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const nomeTitulo = document.getElementById('nomeTitulo');
    const inputNome = document.getElementById('{{ form.nome.id }}');
    const mensagemExtra = document.getElementById('mensagemExtra');

    // Atualiza H1 enquanto digita
    inputNome.addEventListener('input', function() {
        nomeTitulo.textContent = inputNome.value.trim() || 'Stranger';
        mensagemExtra.style.display = 'none'; // esconde mensagem fixa enquanto digita
    });

    // Mostra mensagem fixa se houver
    if(mensagemExtra.textContent.trim() !== '') {
        mensagemExtra.style.display = 'block';
    }

    // Fade-out dos flashes após 10 segundos
    setTimeout(() => {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
            alert.classList.remove('show');
            alert.classList.add('fade');
            setTimeout(() => alert.remove(), 500);
        });
    }, 10000);
});
</script>
{% endblock %}
